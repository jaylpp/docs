{
  "openapi": "3.1.0",
  "info": {
    "title": "熊猫论文 API",
    "description": "熊猫论文·开放API平台 - 提供AIGC文本改写、用户余额查询等核心功能",
    "version": "1.0.0",
    "contact": {
      "name": "熊猫论文·技术支持",
      "email": "support@paperpanda.cn"
    }
  },
  "servers": [
    {
      "url": "https://paperpanda.cn/api/v1",
      "description": "生产环境（默认）"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/aigc/rewrite": {
      "post": {
        "summary": "AIGC文本改写",
        "description": "使用AI技术对文本进行智能改写，支持降AI率、降重率等多种改写类型。自动计费，按字数收费。",
        "operationId": "rewriteContent",
        "tags": ["AIGC改写"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AIGCRewriteRequest"
              },
              "examples": {
                "standard_rewrite": {
                  "summary": "标准改写示例",
                  "value": {
                    "content": "人工智能是研究如何使计算机模拟人类智能的一门科学。它包括机器学习、深度学习等多个领域。",
                    "service_type": "ai-reduce-value",
                    "rewrite_type": 1
                  }
                },
                "english_rewrite": {
                  "summary": "英文改写示例",
                  "value": {
                    "content": "Artificial intelligence is the simulation of human intelligence processes by machines, especially computer systems.",
                    "service_type": "ai-reduce",
                    "rewrite_type": 4
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "改写成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AIGCRewriteResponse"
                },
                "examples": {
                  "success": {
                    "summary": "成功响应",
                    "value": {
                      "amount": 47.58,
                      "code": 200,
                      "data": "人工智能技术是专门研究让计算机系统能够模拟和实现人类智慧行为的学科领域。该领域涵盖了机器学习算法、深度神经网络等众多技术分支。",
                      "message": "改写成功"
                    }
                  },
                  "unpaid": {
                    "summary": "欠费响应",
                    "value": {
                      "amount": 47.58,
                      "code": 200,
                      "data": "处理完成, 因已欠费, 需充值回正后, 进入右侧「生成记录」页面查看结果!",
                      "message": "处理完成, 因已欠费, 需充值回正后, 进入右侧「生成记录」页面查看结果!"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "请求参数错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "detail": "余额不足，当前余额: 10.00元，预估费用: 47.58元"
                }
              }
            }
          },
          "401": {
            "description": "未授权 - API Key无效或已过期",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "detail": "API密钥无效或已过期"
                }
              }
            }
          },
          "429": {
            "description": "请求频率超限",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "detail": "请求过于频繁，已超出QPM限制（10次/分钟）"
                }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AIGCRewriteResponse"
                },
                "example": {
                  "amount": 47.58,
                  "code": 500,
                  "data": "改写失败: AI服务暂时不可用",
                  "message": "处理失败: AI服务暂时不可用"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/billing/balance": {
      "get": {
        "summary": "获取用户余额",
        "description": "查询当前用户的账户余额信息，包括当前余额、累计充值、累计消费等。",
        "operationId": "getUserBalance",
        "tags": ["用户账户"],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "查询成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserBalanceResponse"
                },
                "example": {
                  "user_id": 123,
                  "current_balance": "158.50",
                  "total_recharged": "500.00",
                  "total_consumed": "341.50",
                  "created_at": "2025-01-15T10:30:00+08:00",
                  "updated_at": "2025-09-30T14:20:00+08:00"
                }
              }
            }
          },
          "401": {
            "description": "未授权 - API Key无效或已过期",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "detail": "用户未认证，请先登录"
                }
              }
            }
          },
          "500": {
            "description": "服务器内部错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "detail": "服务器内部错误"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AIGCRewriteRequest": {
        "type": "object",
        "required": ["content", "service_type", "rewrite_type"],
        "properties": {
          "content": {
            "type": "string",
            "minLength": 1,
            "maxLength": 20000,
            "description": "要改写的文本内容，1-20000字符",
            "example": "人工智能是研究如何使计算机模拟人类智能的一门科学。"
          },
          "service_type": {
            "type": "string",
            "enum": [
              "ai-reduce-value",
              "ai-reduce",
              "duplicate-reduce",
              "ai-duplicate",
              "advance"
            ],
            "description": "服务类型：ai-reduce-value（降AI超值）、ai-reduce（降AI）、duplicate-reduce（降重）、ai-duplicate（降AI+降重）、advance（高级咨询）",
            "example": "ai-reduce-value"
          },
          "rewrite_type": {
            "type": "integer",
            "minimum": 1,
            "maximum": 99,
            "description": "改写类型ID，1=标准改写，2=维普改写，3=通用改写，4=英文改写，5=通用降重，6=GIZIDA改写，7=双降知网，8=双降维普，9=双降通用，10=双降GIZIDA，11=朱雀改写",
            "example": 1
          }
        }
      },
      "AIGCRewriteResponse": {
        "type": "object",
        "required": ["amount", "code", "data", "message"],
        "properties": {
          "amount": {
            "type": "number",
            "format": "float",
            "description": "本次消费金额（元）",
            "example": 47.58
          },
          "code": {
            "type": "integer",
            "description": "响应状态码，200=成功，500=失败",
            "example": 200
          },
          "data": {
            "type": "string",
            "description": "改写后的文本内容，或错误提示信息",
            "example": "人工智能技术是专门研究让计算机系统能够模拟和实现人类智慧行为的学科领域。"
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "改写成功"
          }
        }
      },
      "UserBalanceResponse": {
        "type": "object",
        "required": [
          "user_id",
          "current_balance",
          "total_recharged",
          "total_consumed",
          "created_at",
          "updated_at"
        ],
        "properties": {
          "user_id": {
            "type": "integer",
            "description": "用户ID",
            "example": 123
          },
          "current_balance": {
            "type": "string",
            "description": "当前余额（元）",
            "example": "158.50"
          },
          "total_recharged": {
            "type": "string",
            "description": "累计充值金额（元）",
            "example": "500.00"
          },
          "total_consumed": {
            "type": "string",
            "description": "累计消费金额（元）",
            "example": "341.50"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "账户创建时间（北京时间）",
            "example": "2025-01-15T10:30:00+08:00"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "最后更新时间（北京时间）",
            "example": "2025-09-30T14:20:00+08:00"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "required": ["detail"],
        "properties": {
          "detail": {
            "type": "string",
            "description": "错误详情",
            "example": "API密钥无效或已过期"
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API Key",
        "description": "使用API Key进行认证，格式：Bearer ak_xxxxxxxxxxxxxxxx"
      }
    }
  },
  "tags": [
    {
      "name": "AIGC改写",
      "description": "AI文本智能改写服务，支持降AI率、降重率等多种改写模式"
    },
    {
      "name": "用户账户",
      "description": "用户账户相关接口，包括余额查询、消费记录等"
    }
  ]
}
